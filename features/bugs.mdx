---
title: Bug & Ideas Portal
description: >-
  Минимальный аналог bugs.telegram.org, размещённый на поддомене корпоративного
  сервиса. Позволяет сотрудникам сообщать о багах или предлагать улучшения,
  голосовать за заявки, обсуждать их в комментариях и прикладывать файлы.
---
### Функциональные возможности

| Возможность             | Описание                                                                                                           |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------ |
| Список заявок           | Фильтры по статусу, тегам, типу (bug/idea), текстовому поиску и «только мои». Сортировка по дате или популярности. |
| Карточка заявки         | Статус, тип, автор, теги, описание, вложения, история активности.                                                  |
| Создание/редактирование | Автор может обновлять заголовок, описание, тип и теги. Файлы добавляются через Supabase Storage.                   |
| Комментарии             | Markdown‑совместимые комментарии с редактированием и удалением автором. Модераторы могут удалять любые сообщения.  |
| Лайки/дизлайки          | По одному голосу на пользователя. В списке отображается только количество лайков в соответствии с требованием.     |
| Теги                    | Модераторы управляют справочником тегов прямо из интерфейса.                                                       |
| Модерация               | Модераторы меняют статусы (Open → Accepted → Fixed → Rejected → Duplicate) и редактируют теги/описания.            |

### Схема данных

| Таблица              | Назначение                                                                     |
| -------------------- | ------------------------------------------------------------------------------ |
| `reports`            | Основные данные заявки (title, description, kind, status, автор, метаданные).  |
| `report_comments`    | Комментарии пользователей, триггер bump'ит `last_activity_at`.                 |
| `report_attachments` | Метаданные загруженных файлов и путь к объекту в `storage.report-attachments`. |
| `report_votes`       | Хранит лайк/дизлайк конкретного пользователя.                                  |
| `tags`               | Каталог тегов для классификации заявок.                                        |
| `report_tags`        | Связь «многие ко многим» между заявками и тегами.                              |
| `report_moderators`  | Список пользователей с правами модерации (дополняет `is_admin_or_moderator`).  |

Дополнительно: view `v_reports_overview` агрегирует likes/dislikes/comments для списка.

### Авторизация и RLS

- Все таблицы включают RLS.

- `public.can_moderate_reports()` проверяет либо глобальную роль (admin/moderator), либо наличие записи в `report_moderators`.

- INSERT/UPDATE для заявок разрешён автору, но смена статуса защищена триггером `enforce_report_status_rules`.

- Вложения хранятся в Supabase Storage bucket `report-attachments` с политиками «аутентифицированные могут читать/писать».

### Интерфейс

- **Маршруты**: `/bugs` (список), `/bugs/:id` (детали).

- **Компоненты**: `ReportCard`, `ReportFiltersBar`, `ReportFormDialog`, `AttachmentsSection`, `ReportComments`, `VoteButtons`, `TagManager`.

- **Навигация**: новый пункт меню «Баг‑трекер» в основном сайдбаре и нижнем меню.

### Переводы

Все строки добавлены в `src/i18n/locales/ru.json` и `en.json`. По умолчанию русская локализация.

### Работа с файлами

- Ограничение: 15 MB на прикрепление.

- Имя файла санитизируется перед загрузкой.

- После upload создаётся запись в `report_attachments`, а публичный URL вычисляется на лету через `getPublicUrl`.

### Тестирование

Основные сценарии покрываются интеграционно:

1. Создание заявки с тегами и вложениями.

2. Смена статуса модератором.

3. Создание/удаление комментариев автором и модератором.

4. Голосование и обновление счетчиков во view.

5. CRUD тегов через UI (доступно только модераторам).

